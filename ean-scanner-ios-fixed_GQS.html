<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>EAN Scanner - Location Lookup</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: #2196F3;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .content {
            padding: 20px;
        }
        
        #reader {
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        #reader video {
            width: 100% !important;
            height: auto !important;
            border-radius: 5px;
        }
        
        .result-box {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-box.show {
            display: block;
        }
        
        .result-box.error {
            background: #ffebee;
            border-color: #f44336;
        }
        
        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 32px;
            font-weight: bold;
            color: #2196F3;
        }
        
        .result-box.error .result-value {
            color: #f44336;
            font-size: 18px;
        }
        
        .ean-display {
            margin-top: 10px;
            font-size: 16px;
            color: #666;
        }
        
        .manual-input {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
        
        .manual-input h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .input-group button {
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .input-group button:active {
            background: #1976D2;
        }
        
        .toggle-camera {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .toggle-camera:active {
            background: #45a049;
        }
        
        .toggle-camera.stop {
            background: #f44336;
        }
        
        .toggle-camera.stop:active {
            background: #d32f2f;
        }

        .toggle-camera:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .stats {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .status-message {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 5px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #1976D2;
            text-align: center;
            display: none;
        }

        .status-message.show {
            display: block;
        }

        .status-message.error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }

        .status-message.success {
            background: #e8f5e9;
            border-color: #4CAF50;
            color: #2e7d32;
        }

        .permission-help {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #856404;
            display: none;
        }

        .permission-help.show {
            display: block;
        }

        .permission-help strong {
            display: block;
            margin-bottom: 8px;
        }

        .permission-help ol {
            margin-left: 20px;
            margin-top: 8px;
        }

        .permission-help li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ EAN Scanner</h1>
            <p>Scan barcode to find location</p>
        </div>
        
        <div class="content">
            <div id="statusMessage" class="status-message"></div>
            
            <div id="permissionHelp" class="permission-help">
                <strong>üì± Camera Permission Required</strong>
                To use the scanner, please allow camera access:
                <ol>
                    <li>When prompted, tap <strong>"Allow"</strong></li>
                    <li>If you accidentally blocked it, go to <strong>Settings > Safari > Camera</strong> and select <strong>"Allow"</strong></li>
                    <li>Then refresh this page</li>
                </ol>
            </div>

            <button id="toggleCamera" class="toggle-camera">Start Camera</button>
            
            <div id="reader" style="display:none;"></div>
            
            <div id="result" class="result-box">
                <div class="result-label">Location:</div>
                <div class="result-value" id="resultValue"></div>
                <div class="ean-display" id="eanDisplay"></div>
            </div>
            
            <div class="manual-input">
                <h3>Or enter manually:</h3>
                <div class="input-group">
                    <input type="text" id="manualEan" placeholder="Enter EAN code" inputmode="numeric" />
                    <button onclick="lookupManual()">Lookup</button>
                </div>
            </div>

            <div class="stats">
                Database: <span id="dbCount">0</span> EAN codes loaded
            </div>
        </div>
    </div>

    <script>
const eanDatabase = {
            "7630867864045": "Pallet 1",
            "7630867864052": "Pallet 1",
            "7630867864076": "Pallet 1",
            "7630867864083": "Pallet 1",
            "7630867864090": "Pallet 1",
            "7630867864106": "Pallet 1",
            "7630867864113": "Pallet 1",
            "7630867864120": "Pallet 1",
            "7630867864137": "Pallet 1",
            "7630867864144": "Pallet 1",
            "7630867864151": "Pallet 1",
            "7630867864175": "Pallet 1",
            "7630867896411": "Tafel 1",
            "7630867896428": "Tafel 1",
            "7630867896435": "Tafel 1",
            "7630867896442": "Tafel 1",
            "7630867896459": "Tafel 1",
            "7630867896480": "Tafel 1",
            "7630867896497": "Tafel 1",
            "7630867896510": "Tafel 1",
            "7630867838374": "Tafel 1",
            "7630867838381": "Tafel 1",
            "7630867838398": "Tafel 1",
            "7630867838411": "Tafel 1",
            "7630867838428": "Tafel 1",
            "7630867838459": "Tafel 1",
            "7630867838480": "Tafel 1",
            "7630867881196": "Tafel 1",
            "7630867881219": "Tafel 1",
            "7630867881226": "Tafel 1",
            "7630867881233": "Tafel 1",
            "7630867881257": "Tafel 1",
            "7630867881288": "Tafel 1",
            "7630867881295": "Tafel 1",
            "7630867824667": "Tafel 1",
            "7630867824674": "Tafel 1",
            "7630867824681": "Tafel 1",
            "7630867824698": "Tafel 1",
            "7630867824704": "Tafel 1",
            "7630867824711": "Tafel 1",
            "7630867824728": "Tafel 1",
            "7630419177548": "Tafel 1",
            "7630419177555": "Tafel 1",
            "7630419177593": "Tafel 1",
            "7630419177609": "Tafel 1",
            "7630419177623": "Tafel 1",
            "7630419177630": "Tafel 1",
            "7630419177654": "Tafel 1",
            "7630440633839": "Tafel 1",
            "7630440633846": "Tafel 1",
            "7630440633853": "Tafel 1",
            "7630440633860": "Tafel 1",
            "7630440633877": "Tafel 1",
            "7630440633921": "Tafel 1",
            "7630867883619": "Tafel 1",
            "7630867883657": "Tafel 1",
            "7630867883671": "Tafel 1",
            "7630867883701": "Tafel 1",
            "7630867883718": "Tafel 1",
            "7630867883725": "Tafel 1",
            "7640404587726": "Tafel 1",
            "7640404587733": "Tafel 1",
            "7640404587757": "Tafel 1",
            "7640404587788": "Tafel 1",
            "7640404587818": "Tafel 1",
            "7640404587825": "Tafel 1",
            "7630867882414": "Tafel 1",
            "7630867882421": "Tafel 1",
            "7630867882438": "Tafel 1",
            "7630867882445": "Tafel 1",
            "7630867882452": "Tafel 1",
            "7630867882469": "Tafel 1",
            "7630867893335": "Tafel 1",
            "7630867893359": "Tafel 1",
            "7630867893373": "Tafel 1",
            "7630867893380": "Tafel 1",
            "7630867893410": "Tafel 1",
            "7630867894165": "Tafel 2",
            "7630867894189": "Tafel 2",
            "7630867894196": "Tafel 2",
            "7630867894219": "Tafel 2",
            "7630867894226": "Tafel 2",
            "7630867841299": "Tafel 2",
            "7630867841312": "Tafel 2",
            "7630867841350": "Tafel 2",
            "7630867841367": "Tafel 2",
            "7630867841404": "Tafel 2",
            "7615537006147": "Tafel 2",
            "7615537006154": "Tafel 2",
            "7615537006185": "Tafel 2",
            "7615537006246": "Tafel 2",
            "7615537006253": "Tafel 2",
            "7630867825886": "Tafel 2",
            "7630867825916": "Tafel 2",
            "7630867825978": "Tafel 2",
            "7630867826005": "Tafel 2",
            "7630867826012": "Tafel 2",
            "7615537008448": "Tafel 2",
            "7615537008462": "Tafel 2",
            "7615537008523": "Tafel 2",
            "7615537008530": "Tafel 2",
            "7615537008547": "Tafel 2",
            "7630867884302": "Tafel 2",
            "7630867884326": "Tafel 2",
            "7630867884333": "Tafel 2",
            "7630867884357": "Tafel 2",
            "7630867884388": "Tafel 2",
            "7630867828276": "Tafel 2",
            "7630867828313": "Tafel 2",
            "7630867828320": "Tafel 2",
            "7630867828337": "Tafel 2",
            "7630867828382": "Tafel 2",
            "7615537009407": "Tafel 2",
            "7615537009445": "Tafel 2",
            "7615537009452": "Tafel 2",
            "7615537009483": "Tafel 2",
            "7615537009506": "Tafel 2",
            "7630040588393": "Tafel 2",
            "7630040588447": "Tafel 2",
            "7630040588454": "Tafel 2",
            "7630040588461": "Tafel 2",
            "7630040588478": "Tafel 2",
            "7630867833171": "Tafel 2",
            "7630867833195": "Tafel 2",
            "7630867833249": "Tafel 2",
            "7630867833256": "Tafel 2",
            "7630867833270": "Tafel 2",
            "7630867836172": "Tafel 3",
            "7630867836189": "Tafel 3",
            "7630867836202": "Tafel 3",
            "7630867836264": "Tafel 3",
            "7630867891683": "Tafel 3",
            "7630867891690": "Tafel 3",
            "7630867891737": "Tafel 3",
            "7630867891744": "Tafel 3",
            "7630867885125": "Tafel 3",
            "7630867885156": "Tafel 3",
            "7630867885170": "Tafel 3",
            "7630867885194": "Tafel 3",
            "7630867882568": "Tafel 3",
            "7630867882575": "Tafel 3",
            "7630867882599": "Tafel 3",
            "7630867882636": "Tafel 3",
            "7630867837070": "Tafel 3",
            "7630867837117": "Tafel 3",
            "7630867837124": "Tafel 3",
            "7630867837162": "Tafel 3",
            "7630419104872": "Pallet 2",
            "7630419104926": "Pallet 2",
            "7630419104971": "Pallet 2",
            "7630419104995": "Pallet 2",
            "7615537155449": "Tafel 3",
            "7615537155463": "Tafel 3",
            "7615537155531": "Tafel 3",
            "7615537155548": "Tafel 3",
            "7630867841022": "Tafel 3",
            "7630867841046": "Tafel 3",
            "7630867841060": "Tafel 3",
            "7630867841091": "Tafel 3",
            "7630867886627": "Tafel 3",
            "7630867886641": "Tafel 3",
            "7630867886665": "Tafel 3",
            "7630867886672": "Tafel 3",
            "7630440660217": "Tafel 3",
            "7630440660248": "Tafel 3",
            "7630440660293": "Tafel 3",
            "7630440660316": "Tafel 3",
            "7615537044408": "Tafel 3",
            "7615537044439": "Tafel 3",
            "7615537044446": "Tafel 3",
            "7615537044491": "Tafel 3",
            "7630867829815": "Tafel 4",
            "7630867829822": "Tafel 4",
            "7630867829846": "Tafel 4",
            "7630867829914": "Tafel 4",
            "7630867877632": "Tafel 4",
            "7630867877649": "Tafel 4",
            "7630867877700": "Tafel 4",
            "7630867877731": "Tafel 4",
            "7630867835380": "Tafel 4",
            "7630867835403": "Tafel 4",
            "7630867835410": "Tafel 4",
            "7630867835502": "Tafel 4",
            "7615537003849": "Tafel 4",
            "7615537003870": "Tafel 4",
            "7615537003887": "Tafel 4",
            "7615537003924": "Tafel 4",
            "7630867821604": "Tafel 4",
            "7630867821635": "Tafel 4",
            "7630867821697": "Tafel 4",
            "7630867821727": "Tafel 4",
            "7630040571449": "Tafel 4",
            "7630040571463": "Tafel 4",
            "7630040571487": "Tafel 4",
            "7630040571500": "Tafel 4",
            "7615537003733": "Tafel 4",
            "7615537003740": "Tafel 4",
            "7615537003832": "Tafel 4",
            "7630419175247": "Tafel 4",
            "7630419175254": "Tafel 4",
            "7630419175377": "Tafel 4",
            "7630440635383": "Tafel 4",
            "7630440635451": "Tafel 4",
            "7630440635482": "Tafel 4",
            "7630440699279": "Tafel 4",
            "7630440699347": "Tafel 4",
            "7630440699361": "Tafel 4",
            "7630419175674": "Tafel 4",
            "7630419175681": "Tafel 4",
            "7630419175698": "Tafel 4",
            "7630419176176": "Tafel 4",
            "7630419176183": "Tafel 4",
            "7630419176299": "Tafel 4",
            "7630867838534": "Tafel 4",
            "7630867838541": "Tafel 4",
            "7630867838626": "Tafel 4",
            "7630867812992": "Tafel 4",
            "7630867813029": "Tafel 4",
            "7630867813050": "Tafel 4",
            "7630867825657": "Tafel 4",
            "7630867825695": "Tafel 4",
            "7630867825718": "Tafel 4",
            "7615537011646": "Tafel 5",
            "7615537011691": "Tafel 5",
            "7615537011745": "Tafel 5",
            "7630867832211": "Tafel 5",
            "7630867832228": "Tafel 5",
            "7630867832242": "Tafel 5",
            "7615537011820": "Tafel 5",
            "7615537011837": "Tafel 5",
            "7615537011899": "Tafel 5",
            "7615537109602": "Tafel 5",
            "7615537109619": "Tafel 5",
            "7615537109640": "Tafel 5",
            "7615537012612": "Tafel 5",
            "7615537012674": "Tafel 5",
            "7615537012681": "Tafel 5",
            "7630440656210": "Tafel 5",
            "7630440656227": "Tafel 5",
            "7630440656234": "Tafel 5",
            "7630867836714": "Tafel 5",
            "7630867836745": "Tafel 5",
            "7630867836752": "Tafel 5",
            "7630867878059": "Tafel 5",
            "7630867878103": "Tafel 5",
            "7630867878134": "Tafel 5",
            "7630867835144": "Tafel 5",
            "7630867835229": "Tafel 5",
            "7630867835236": "Tafel 5",
            "7630867897081": "Tafel 5",
            "7630867897104": "Tafel 5",
            "7630867897166": "Tafel 5",
            "7615537007663": "Tafel 5",
            "7615537007670": "Tafel 5",
            "7615537007687": "Tafel 5",
            "7630867892123": "Tafel 5",
            "7630867892154": "Tafel 5",
            "7630867892161": "Tafel 5",
            "7630419174189": "Tafel 5",
            "7630419174264": "Tafel 5",
            "7630419174271": "Tafel 5",
            "7630867824070": "Tafel 5",
            "7630867824100": "Tafel 5",
            "7630867824117": "Tafel 5",
            "7630419106395": "Tafel 5",
            "7630419106470": "Tafel 5",
            "7630419106494": "Tafel 5",
            "7630867819007": "Tafel 6",
            "7630867819083": "Tafel 6",
            "7630867819120": "Tafel 6",
            "7630867830521": "Tafel 6",
            "7630867830538": "Tafel 6",
            "7630867830545": "Tafel 6",
            "7630867835823": "Tafel 6",
            "7630867835861": "Tafel 6",
            "7630867835892": "Tafel 6",
            "7630867837995": "Tafel 6",
            "7630867838022": "Tafel 6",
            "7630867838077": "Tafel 6",
            "7630440654827": "Tafel 6",
            "7630440654841": "Tafel 6",
            "7630440654872": "Tafel 6",
            "7630419103547": "Tafel 6",
            "7630419103554": "Tafel 6",
            "7630419103622": "Tafel 6",
            "7615537005072": "Tafel 6",
            "7615537005102": "Tafel 6",
            "7615537005164": "Tafel 6",
            "7630867884838": "Tafel 6",
            "7630867884883": "Tafel 6",
            "7630867884890": "Tafel 6",
            "7630867838695": "Tafel 6",
            "7630867838725": "Tafel 6",
            "7630867838749": "Tafel 6",
            "7630867884197": "Tafel 6",
            "7630867884210": "Tafel 6",
            "7630867884265": "Tafel 6",
            "7630867837506": "Tafel 6",
            "7630867837551": "Tafel 6",
            "7630867837568": "Tafel 6",
            "7630419105305": "Tafel 6",
            "7630419105381": "Tafel 6",
            "7630419105398": "Tafel 6",
            "7630867831481": "Tafel 6",
            "7630867831597": "Tafel 6",
            "7630867831603": "Tafel 6",
            "7630867878769": "Tafel 6",
            "7630867878790": "Tafel 6",
            "7630867878806": "Tafel 6",
            "7615537002644": "Tafel 6",
            "7615537002750": "Tafel 6",
            "7630867826210": "Tafel 7",
            "7630867826258": "Tafel 7",
            "7630419160823": "Tafel 7",
            "7630419160847": "Tafel 7",
            "7630419121268": "Tafel 7",
            "7630419121343": "Tafel 7",
            "7615537123332": "Tafel 7",
            "7615537123349": "Tafel 7",
            "7630867890815": "Tafel 7",
            "7630867890822": "Tafel 7",
            "7615537155296": "Tafel 7",
            "7615537155371": "Tafel 7",
            "7630867813920": "Tafel 7",
            "7630867813951": "Tafel 7",
            "7630867827606": "Tafel 7",
            "7630867827699": "Tafel 7",
            "7615537012223": "Tafel 7",
            "7615537012285": "Tafel 7",
            "7630419112716": "Tafel 7",
            "7630419112839": "Tafel 7",
            "7630440628996": "Tafel 7",
            "7630440632207": "Tafel 7",
            "7630867898576": "Tafel 7",
            "7630867898675": "Tafel 7",
            "7630867833430": "Tafel 7",
            "7630867833553": "Tafel 7",
            "7630867822434": "Tafel 7",
            "7630867822458": "Tafel 7",
            "7630440637738": "Tafel 7",
            "7630440637752": "Tafel 7",
            "7630419118107": "Tafel 8",
            "7630419118114": "Tafel 8",
            "7615537010939": "Tafel 8",
            "7615537010984": "Tafel 8",
            "7630440627852": "Tafel 8",
            "7630440627869": "Tafel 8",
            "7630867822977": "Tafel 8",
            "7630867823011": "Tafel 8",
            "7630867839685": "Tafel 8",
            "7630867839692": "Tafel 8",
            "7630440698036": "Tafel 8",
            "7630440698043": "Tafel 8",
            "7630419112112": "Tafel 8",
            "7630419112136": "Tafel 8",
            "7640404582486": "Tafel 8",
            "7640404582608": "Tafel 8",
            "7630867833973": "Tafel 8",
            "7630867834062": "Tafel 8",
            "7630867878646": "Tafel 8",
            "7630867878653": "Tafel 8",
            "7630419106258": "Tafel 8",
            "7630419106357": "Tafel 8",
            "7630419191469": "Tafel 8",
            "7630419191490": "Tafel 8",
            "7630040592321": "Tafel 8",
            "7630040592376": "Tafel 8",
            "7630419111108": "Tafel 8",
            "7630419111221": "Tafel 8",
            "7630040595865": "Tafel 8",
            "7630040595872": "Tafel 8",
            "7630867879544": "Tafel 9",
            "7630867879599": "Tafel 9",
            "7615537106625": "Tafel 9",
            "7615537106717": "Tafel 9",
            "7630867835014": "Tafel 9",
            "7630867835069": "Tafel 9",
            "7615537006307": "Tafel 9",
            "7615537006369": "Tafel 9",
            "7630419110972": "Tafel 9",
            "7630419111085": "Tafel 9",
            "7615537006833": "Tafel 9",
            "7615537006918": "Tafel 9",
            "7630419102182": "Tafel 9",
            "7630419102212": "Tafel 9",
            "7630867837797": "Tafel 9",
            "7630867837803": "Tafel 9",
            "7630867881042": "Tafel 9",
            "7630867881110": "Tafel 9",
            "7630867825848": "Tafel 9",
            "7630867825855": "Tafel 9",
            "7630867893847": "Tafel 9",
            "7630867893854": "Tafel 9",
            "7630867829389": "Tafel 9",
            "7630867829433": "Tafel 9",
            "7630419170280": "Tafel 9",
            "7630419170303": "Tafel 9",
            "7630867826340": "Tafel 9",
            "7630867826401": "Tafel 9",
            "7630867894028": "Tafel 9",
            "7630867894066": "Tafel 9",
            "7630867878462": "Tafel 10",
            "7630867878561": "Tafel 10",
            "7630867881592": "Tafel 10",
            "7630867881660": "Tafel 10",
            "7630419173885": "Tafel 10",
            "7630419173922": "Tafel 10",
            "7630867895254": "Tafel 10",
            "7630867895278": "Tafel 10",
            "7615537003047": "Tafel 10",
            "7615537003108": "Tafel 10",
            "7630440640554": "Tafel 10",
            "7630440640578": "Tafel 10",
            "7615537003320": "Tafel 10",
            "7615537003429": "Tafel 10",
            "7630419179641": "Tafel 10",
            "7630419179658": "Tafel 10",
            "7630440656036": "Tafel 10",
            "7630440656050": "Tafel 10",
            "7630867825077": "Tafel 10",
            "7630867825169": "Tafel 10",
            "7630867884975": "Tafel 10",
            "7630867885002": "Tafel 10",
            "7630440639107": "Tafel 10",
            "7630440639121": "Tafel 10",
            "7630867829761": "Tafel 10",
            "7630867829792": "Tafel 10",
            "7630867839630": "Tafel 10",
            "7630867839647": "Tafel 10",
            "7630867887976": "Tafel 10",
            "7630867887990": "Tafel 10",
            "7630040575072": "Tafel 1",
            "7630040575157": "Tafel 1",
            "7630867838800": "Tafel 1",
            "7630867838855": "Tafel 1",
            "7630867817744": "Tafel 1",
            "7630867817782": "Tafel 1",
            "7615537003634": "Tafel 1",
            "7615537003665": "Tafel 1",
            "7630867817836": "Tafel 1",
            "7630867817959": "Tafel 1",
            "7630867821994": "Tafel 2",
            "7630867822090": "Tafel 2",
            "7630867818710": "Tafel 2",
            "7630867818727": "Tafel 2",
            "7615537011547": "Tafel 2",
            "7615537011585": "Tafel 2",
            "7630419105718": "Tafel 2",
            "7630419105817": "Tafel 2",
            "7630419118923": "Tafel 2",
            "7630419119043": "Tafel 2",
            "7630419106005": "Tafel 3",
            "7630419106036": "Tafel 3",
            "7630440612247": "Tafel 3",
            "7630440612292": "Tafel 3",
            "7630867897364": "Tafel 3",
            "7630867897388": "Tafel 3",
            "7630440664345": "Tafel 3",
            "7630440664369": "Tafel 3",
            "7630867814873": "Tafel 3",
            "7630867814880": "Tafel 3",
            "7615537088617": "Tafel 11",
            "7615537088624": "Tafel 11",
            "7630867884623": "Tafel 11",
            "7630867884685": "Tafel 11",
            "7630867855302": "Tafel 11",
            "7630867855364": "Tafel 11",
            "7630419173229": "Tafel 11",
            "7630419173281": "Tafel 11",
            "7630419180814": "Tafel 11",
            "7630419180876": "Tafel 11",
            "7630867826029": "Tafel 11",
            "7630867826036": "Tafel 11",
            "7630867891560": "Tafel 11",
            "7630867891652": "Tafel 11",
            "7630440699026": "Tafel 11",
            "7630440699040": "Tafel 11",
            "7630440663355": "X",
            "7630440629870": "X",
            "7630440663461": "X",
            "7630867882018": "X",
            "7630867828177": "X",
            "7630440699880": "X",
            "7630867834734": "X",
            "7640404589591": "X",
            "7630419175605": "X",
            "7630867879476": "X",
            "7630440653448": "Tafel 11",
            "7630867824896": "X",
            "7630440654582": "Tafel 11",
            "7630419103233": "X",
            "7615537043357": "X",
            "7630867815344": "X",
            "7630867895964": "X",
            "7630419172703": "X",
            "7630440640097": "Tafel",
            "7630867880878": "X",
            "7640404589652": "Tafel 11",
            "7630440658474": "X",
            "7615537009100": "X",
            "7630440630463": "X",
            "7630867821079": "X",
            "7630440630708": "X",
            "7630867828993": "X",
            "7630867822618": "X",
            "7630440659648": "X",
            "7630867897951": "X",
            "7630440698302": "X",
            "7630419172420": "Tafel 11",
            "7630867880175": "X",
            "7615537092218": "X",
            "7630419110668": "X",
            "7630867822298": "X",
            "7630867892987": "X",
            "7630040593953": "X",
            "7630867865868": "X",
            "7630419173199": "X",
            "7630867819243": "X",
            "7615537000381": "X",
            "7630867815467": "X",
            "7630867882315": "X",
            "7630867899757": "X",
            "7630040577779": "X",
            "7630867832464": "X",
            "7630867838114": "X",
            "7630440654995": "Tafel 11",
            "7630419173052": "X",
            "7630867820614": "X",
            "7630040590051": "X",
            "7615537010373": "X",
            "7630867863925": "Tafel 11",
            "7630419111825": "Tafel11",
            "7630867883039": "X",
            "7630867877076": "Tafel 11",
            "7615537001470": "X",
            "7630440659396": "Pallet 3",
            "7630419103080": "X",
            "7630419119302": "X",
            "7615537002446": "Tafel 11",
            "7630867877946": "Tafel 11",
            "7630867829952": "X",
            "7615537009643": "X",
            "7630867883244": "X",
            "7630867825466": "X",
            "7630440639800": "X",
            "7630867830781": "X",
            "7630867818369": "X",
            "7630867831023": "X",
            "7630867890112": "X",
            "7630440659822": "X",
            "7630867884074": "X",
            "7630867885231": "Tafel 11",
            "7630040514446": "X",
            "7630419170693": "X",
            "7630867880618": "X",
            "7615537123479": "X",
            "7630419172604": "X",
            "7630419113751": "Tafel 11",
            "7630419115878": "X",
            "7630867884524": "Tafel11",
            "7630419105503": "X",
            "7630867835762": "X",
            "7630440656470": "X",
            "7630419110828": "X",
            "7630867834482": "X",
            "7630867835960": "X",
            "7630419174387": "X",
            "7615537008196": "X",
            "7630867816860": "X",
            "7615537000824": "X",
            "7630419174776": "X",
            "7630440613701": "X",
            "7615537003009": "X",
            "7615537002033": "Tafel 11",
            "7630867888263": "X",
            "7615537009131": "Tafel 11",
            "7630867831825": "X",
            "7630419115953": "X",
            "7630867883145": "X",
            "7630867882131": "Tafel 11",
            "7630867890983": "X",
            "7630867820867": "X",
            "7630867891225": "Tafel 11",
            "7630867821086": "X",
            "7630419163169": "X",
            "7630440670162": "X",
            "7630419104131": "X",
            "7630040575881": "X",
            "7630867880755": "Tafel 11",
            "7615537005256": "X",
            "7630419165064": "X",
            "7630040596084": "X",
            "7630867834451": "X",
            "7615537088549": "X",
            "7630419162698": "X",
            "7630867826586": "X",
            "7630440652717": "X",
            "7630419177029": "X",
            "7630867891294": "X",
            "7630867837056": "X",
            "7630419177524": "X",
            "7615537089058": "X",
            "7630867878868": "Tafel 11",
            "7615537007564": "X",
            "7630419110743": "X",
            "7630867834116": "Tafel 11",
            "7630419118077": "X",
            "7630440631347": "X",
            "7630867839074": "X",
            "7630867814132": "X",
            "7630867824360": "Tafel 11",
            "7630419113164": "X",
            "7630419170112": "X",
            "7630867880106": "X",
            "7630867891867": "X",
            "7630867885729": "X",
            "7630419180562": "X",
            "7630040596237": "X",
            "7630867879087": "Tafel 11",
            "7630867894301": "Tafel 11",
            "7630867836394": "X",
            "7630867877861": "X"
        };
        // Display database count on load
        document.getElementById('dbCount').textContent = Object.keys(eanDatabase).length;

        let html5QrCode = null;
        let isScanning = false;
        let cameraStartAttempts = 0;
        const MAX_ATTEMPTS = 3;
        
        const resultBox = document.getElementById('result');
        const resultValue = document.getElementById('resultValue');
        const eanDisplay = document.getElementById('eanDisplay');
        const toggleButton = document.getElementById('toggleCamera');
        const readerDiv = document.getElementById('reader');
        const statusMessage = document.getElementById('statusMessage');
        const permissionHelp = document.getElementById('permissionHelp');

        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message show';
            if (type === 'error') {
                statusMessage.classList.add('error');
            } else if (type === 'success') {
                statusMessage.classList.add('success');
            }
            
            // Auto-hide after 5 seconds for non-error messages
            if (type !== 'error') {
                setTimeout(() => {
                    statusMessage.classList.remove('show');
                }, 5000);
            }
        }

        function hideStatus() {
            statusMessage.classList.remove('show');
        }

        function lookupEAN(eanCode) {
            // Remove any spaces or dashes
            eanCode = eanCode.replace(/[\s-]/g, '');
            
            if (eanDatabase[eanCode]) {
                resultBox.className = 'result-box show';
                resultValue.textContent = eanDatabase[eanCode];
                eanDisplay.textContent = `EAN: ${eanCode}`;
                
                // Play success sound
                playBeep();
                
                // Auto-clear after 3 seconds if still scanning
                setTimeout(() => {
                    if (isScanning) {
                        resultBox.classList.remove('show');
                    }
                }, 3000);
            } else {
                resultBox.className = 'result-box show error';
                resultValue.textContent = 'EAN not found in database';
                eanDisplay.textContent = `Scanned: ${eanCode}`;
            }
        }

        function playBeep() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Silently fail if audio context not available
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            lookupEAN(decodedText);
        }

        function onScanError(errorMessage) {
            // Silently ignore scan errors (they happen frequently)
        }

        async function startScanning() {
            cameraStartAttempts++;
            toggleButton.disabled = true;
            hideStatus();
            permissionHelp.classList.remove('show');

            try {
                showStatus('üé• Initializing camera...', 'info');
                
                // Clean up any existing instance
                if (html5QrCode) {
                    try {
                        await html5QrCode.stop();
                        html5QrCode.clear();
                    } catch (e) {
                        // Ignore cleanup errors
                    }
                    html5QrCode = null;
                }

                // Create new instance
                html5QrCode = new Html5Qrcode("reader");
                
                // Show reader div
                readerDiv.style.display = 'block';
                
                showStatus('üì∑ Requesting camera access...', 'info');
                
                // Try to get cameras
                const devices = await Html5Qrcode.getCameras();
                
                if (!devices || devices.length === 0) {
                    throw new Error('No cameras found on this device');
                }

                // Find back camera (environment-facing)
                let cameraId = devices[0].id;
                for (let device of devices) {
                    if (device.label.toLowerCase().includes('back') || 
                        device.label.toLowerCase().includes('rear') ||
                        device.label.toLowerCase().includes('environment')) {
                        cameraId = device.id;
                        break;
                    }
                }

                // If more than one camera, prefer the last one (usually back camera on mobile)
                if (devices.length > 1) {
                    cameraId = devices[devices.length - 1].id;
                }

                showStatus('üì∏ Starting camera...', 'info');

                // Start scanning with the selected camera
                await html5QrCode.start(
                    cameraId,
                    {
                        fps: 10,
                        qrbox: { width: 250, height: 250 },
                        aspectRatio: 1.0,
                        formatsToSupport: [
                            Html5QrcodeSupportedFormats.EAN_13,
                            Html5QrcodeSupportedFormats.EAN_8,
                            Html5QrcodeSupportedFormats.CODE_128,
                            Html5QrcodeSupportedFormats.CODE_39
                        ]
                    },
                    onScanSuccess,
                    onScanError
                );
                
                isScanning = true;
                toggleButton.textContent = 'Stop Camera';
                toggleButton.className = 'toggle-camera stop';
                toggleButton.disabled = false;
                cameraStartAttempts = 0; // Reset on success
                
                showStatus('‚úÖ Camera ready! Scan a barcode', 'success');
                
            } catch (err) {
                console.error('Camera error:', err);
                readerDiv.style.display = 'none';
                toggleButton.disabled = false;
                
                let errorMsg = '';
                
                if (err.name === 'NotAllowedError' || err.message.includes('permission')) {
                    errorMsg = '‚ùå Camera permission denied';
                    permissionHelp.classList.add('show');
                } else if (err.name === 'NotFoundError') {
                    errorMsg = '‚ùå No camera found on this device';
                } else if (err.name === 'NotReadableError' || err.message.includes('in use')) {
                    errorMsg = '‚ùå Camera is in use by another app. Close other apps and try again.';
                } else if (err.message.includes('Initialization')) {
                    errorMsg = '‚ùå Failed to initialize camera. Try refreshing the page.';
                } else {
                    errorMsg = '‚ùå Camera error: ' + (err.message || 'Unknown error');
                    
                    // Offer retry if not too many attempts
                    if (cameraStartAttempts < MAX_ATTEMPTS) {
                        errorMsg += ' Retrying...';
                        setTimeout(() => {
                            startScanning();
                        }, 1000);
                        return;
                    }
                }
                
                showStatus(errorMsg, 'error');
            }
        }

        async function stopScanning() {
            if (html5QrCode && isScanning) {
                try {
                    await html5QrCode.stop();
                    html5QrCode.clear();
                } catch (e) {
                    console.error('Error stopping camera:', e);
                }
                
                readerDiv.style.display = 'none';
                isScanning = false;
                toggleButton.textContent = 'Start Camera';
                toggleButton.className = 'toggle-camera';
                hideStatus();
            }
        }

        toggleButton.addEventListener('click', async () => {
            if (isScanning) {
                await stopScanning();
            } else {
                await startScanning();
            }
        });

        function lookupManual() {
            const ean = document.getElementById('manualEan').value.trim();
            if (ean) {
                lookupEAN(ean);
                document.getElementById('manualEan').value = '';
            }
        }

        // Allow Enter key in manual input
        document.getElementById('manualEan').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                lookupManual();
            }
        });

        // Auto-focus manual input when tapped
        document.getElementById('manualEan').addEventListener('focus', function() {
            this.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    </script>
</body>
</html>
